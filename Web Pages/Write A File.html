<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Write A File</title>
    <link rel="stylesheet" href="appearance.css">
</head>
<body>
    <ol>
        <li>
            Set your name & password for the file
        </li>
        <br>
        <li>
            Re-enter the same password
        </li>
        <br>
        <li>
            Enter the title of your note
        </li>
        <br>
        <li>
            Enter the text in your note
        </li>
        <br>
        <li>
            A file with random-generated name (5-digit number) will be downloaded, You can keep it anywhere!!
        </li>
    </ol>
    <button onclick="NamePassword()">Click To Start</button>
    <br><br>
    <a href="Diary.html">Go Back</a>
</body>
<script src="encryption code.js"></script>
<script>
    var name, pass, same_pass;
    var title, text;
    function NamePassword() {
        document.body.innerHTML = "";
        document.body.style = "padding: 20px;";

        let form = document.createElement("form");
        form.method = "post";
        form.innerHTML = '<label>Enter new Name: </label><input type="text"/><br><br>';
        form.innerHTML += '<label>Enter new Password: </label><input type="password"/><br><br>';
        form.innerHTML += '<label>Re-enter Password: </label><input type="password"/><br><br>';
        form.innerHTML += '<input type="button" value="Submit" onclick="TitleText(this.form)"></form><br><br>';
        document.body.appendChild(form);

        let goBack = document.createElement("a");
        goBack.href = "Diary.html";
        goBack.innerText = "Go Back";
        document.body.appendChild(goBack);

        document.body.appendChild(document.createElement("br"));
        document.body.appendChild(document.createElement("br"));

        let message = document.createElement("p");
        message.id = "message";
        message.style = "text-align: center; font-family: Arial, Helvetica, sans-serif;";
        document.body.appendChild(message);
    }
    function TitleText(someForm) {
        name = someForm.elements[0].value;
        pass = someForm.elements[1].value;
        same_pass = someForm.elements[2].value;
        if(name==="" || pass==="")
            document.getElementById("message").innerText = "Name or/and Password should not be null...";
        else if(pass!==same_pass)
            document.getElementById("message").innerText = "Passwords do not Match...";
        else
        {
            document.body.innerHTML = "";
            document.body.style = "padding: 20px;";

            let form = document.createElement("form");
            form.method = "post";
            form.innerHTML = '<label>Enter Title: </label><br><input name="title"/><br><br>';
            form.innerHTML += '<label>Enter Text: </label><br><textarea name="text" rows="20" cols="80"></textarea><br><br>';
            form.innerHTML += '<input type="button" value="Submit" onclick="WriteAFile(this.form);"></form><br><br>';
            document.body.appendChild(form);

            let goBack = document.createElement("a");
            goBack.href = "Diary.html";
            goBack.innerText = "Go Back";
            document.body.appendChild(goBack);
        }
    }
    function WriteAFile(someForm) {
        title = someForm.elements[0].value;
        text = someForm.elements[1].value;
        let str = name+"THIS_IS_THE_ENDLINE"+pass+"THIS_IS_THE_ENDLINE"+title+"THIS_IS_THE_ENDLINE"+text;
        let Data = [];
        for(let i=0;i<str.length;i++)
            Data.push(str.charCodeAt(i)+encrypt[i%256]);
                
        var saveByteArray = (function () {
            var a = document.createElement("a");
            document.body.appendChild(a);
            a.style = "display: none";
            return function (data,name) {
                var blob = new Blob(data, {type: "octet/stream"}),
                url = window.URL.createObjectURL(blob);
                a.href = url;
                a.download = name;
                a.click();
                window.URL.revokeObjectURL(url);
            };
        }());
                
        let filename = Math.floor(Math.random()*90000)+10000+".dat";
        saveByteArray([Data],filename);

        document.body.innerHTML = "";

        let goBack = document.createElement("a");
        goBack.href = "Diary.html";
        goBack.innerText = "Go Back";
        document.body.appendChild(goBack);

        let message = document.createElement("p");
        message.id = "message";
        message.style = "text-align: center; font-family: Arial, Helvetica, sans-serif;";
        message.innerText = "Your Filename is "+filename;
        document.body.appendChild(message);
    }
</script>
</html>